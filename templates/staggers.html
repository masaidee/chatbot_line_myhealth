<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÇ‡∏£‡∏Ñ‡∏™‡∏°‡∏≠‡∏á</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>

    </style>
</head>
<body>
    <div class="container">
        <h1>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h1>

        <label for="sbp">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ö‡∏ô:</label>
        <input type="text" id="sbp" name="sbp">

        <label for="dbp">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏á:</label>
        <input type="text" id="dbp" name="dbp">

        <label for="his">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤:</label>
        <select id="his">
            <option value="1">‡∏°‡∏µ</option>
            <option value="0">‡πÑ‡∏°‡πà‡∏°‡∏µ</option>
        </select>

        <label for="smoke">‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà:</label>
        <select id="smoke">
            <option value="1">‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà</option>
            <option value="0">‡πÑ‡∏°‡πà‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà</option>
        </select>

        <label for="fbs">‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÉ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î:</label>
        <input type="text" id="fbs" name="fbs">

        <label for="HbAlc">‡∏Æ‡∏µ‡πÇ‡∏°‡πÇ‡∏Å‡∏•‡∏ö‡∏¥‡∏ô A1c:</label>
        <input type="text" id="HbAlc" name="HbAlc">

        <label for="total_Cholesterol">‡∏Ñ‡∏≠‡πÄ‡∏•‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡∏≠‡∏•‡∏£‡∏ß‡∏°:</label>
        <input type="text" id="total_Cholesterol" name="total_Cholesterol">

        <label for="Exe">‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢:</label>
        <select id="Exe">
            <option value="0">‡πÑ‡∏°‡πà‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢</option>
            <option value="1">‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢ 150-200‡∏ô‡∏≤‡∏ó‡∏µ</option>
            <option value="2">‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢ >200 ‡∏ô‡∏≤‡∏ó‡∏µ</option>
        </select>

        <label for="bmi">‡∏î‡∏±‡∏ä‡∏ô‡∏µ‡∏°‡∏ß‡∏•‡∏Å‡∏≤‡∏¢:</label>
        <input type="text" id="bmi" name="bmi">

        <label for="family_his">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</label>
        <select id="family_his">
            <option value="1">‡∏°‡∏µ</option>
            <option value="0">‡πÑ‡∏°‡πà‡∏°‡∏µ</option>
        </select>

        <button onclick="submitData()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    </div>

    <script>
        let API_URL = window.location.origin;
        let userId = "";

        async function initLIFF() {
            try {
                await liff.init({ liffId: "2003057525-1L9EGXEO" });

                if (!liff.isLoggedIn()) {
                    liff.login({ redirectUri: window.location.href });
                    return;
                }

                let profile = await liff.getProfile();
                userId = profile.userId;

                if (!userId) {
                    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á User ID ‡πÑ‡∏î‡πâ");
                    return;
                }

                console.log("‚úÖ User ID:", userId);
            } catch (error) {
                console.error("‚ùå LIFF Init Error:", error);
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î LIFF");
            }
        }

        function validateForm(data) {
            for (const key in data) {
                if (!data[key] && data[key] !== 0) { // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á ‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏° 0
                    let inputElement = document.getElementById(key);
                    let labelElement = document.querySelector(`label[for="${key}"]`);

                    let fieldName = labelElement ? labelElement.innerText : key; // ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å <label>

                    alert(`‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö: ${fieldName}`);

                    if (inputElement) {
                        inputElement.focus(); // ‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏£‡∏≠‡∏Å
                    }

                    return false;
                }
            }
            return true;
        }


        async function submitData() {
            if (!userId) {
                alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ User ID");
                return;
            }

            let data = {
                user_id: userId,
                sbp: parseInt(document.getElementById("sbp").value),
                dbp: parseInt(document.getElementById("dbp").value),
                his: parseInt(document.getElementById("his").value),
                smoke: parseInt(document.getElementById("smoke").value),
                fbs: parseInt(document.getElementById("fbs").value),
                HbAlc: parseInt(document.getElementById("HbAlc").value),
                total_Cholesterol: parseInt(document.getElementById("total_Cholesterol").value),
                Exe: parseInt(document.getElementById("Exe").value),
                bmi: parseInt(document.getElementById("bmi").value),
                family_his: parseInt(document.getElementById("family_his").value),
            };

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (!validateForm(data)) return;

            console.log("üì§ Sending Data:", data);

            try {
                let response = await fetch(`${API_URL}/add_staggers_data`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(data)
                });

                let result = await response.json();
                console.log("‚úÖ Response:", result);
                alert(result.message);
            } catch (error) {
                console.error("‚ùå Error Sending Data:", error);
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
            }
        }

        window.onload = initLIFF;
    </script>
</body>
</html>
